using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using DiscordRPC;

namespace WeAreDevs
{ 
    public class Discord
    {
        private static DiscordRpcClient client;
        private static List<Button> buttons = new List<Button>();

        public static string Username;
        public static string Avatar;
        public static bool PresenceEnabled = true;
        
        public static void Initialize()
        {
            PresenceEnabled = Properties.Settings.Default.DiscordPresence;

            client = new DiscordRpcClient("972520830896595004");
            Logger.WriteLine("Creating Discord Rich Presence Client with application ID 972520830896595004.");
            client.Initialize();
            Logger.WriteLine("Initialized Discord Rich Presence.");

            client.OnReady += (sender, e) =>
            {
                Username = client.CurrentUser.Username;
                Avatar = client.CurrentUser.GetAvatarURL(User.AvatarFormat.PNG, User.AvatarSize.x32);
            };

            buttons.Add(new Button() { Label = "HNT8 Forums", Url = "https://hnt8.net/"});
            Logger.WriteLine("Added HNT8 Forums button with url https://hnt8.net to DiscordRPC.");
            buttons.Add(new Button() { Label = "WeAreDevs Forums", Url = "https://wearedevs.net/" });
            Logger.WriteLine("Added WeAreDevs Forums button with url https://wearedevs.net to DiscordRPC.");

            client.SetPresence(new RichPresence()
            {
                Details = "WeAreDevs Script Executor",
                State = "Initializing Exploit...",
                Assets = new Assets()
                {
                    LargeImageKey = "wrd",
                    SmallImageKey = "hnt8"
                },
                Buttons = buttons.ToArray(),
                Timestamps = new Timestamps
                {
                    Start = DateTime.UtcNow
                }
            });
            Logger.WriteLine("Successfully set Discord Rich Presence State to Initializing Exploit...");
        }

        public static void SetStatus(string state)
        {
            client.SetPresence(new RichPresence()
            {
                Details = "WeAreDevs Script Executor",
                State = state,
                Assets = new Assets()
                {
                    LargeImageKey = "wrd",
                    SmallImageKey = "hnt8"
                },
                Buttons = buttons.ToArray()
            });
            Logger.WriteLine("Successfully set Discord Rich Presence State to " + state);
        }

        public static void ClearPresence()
        {
            client.ClearPresence();
            Logger.WriteLine("Successfully cleared Discord Rich Presence.");
        }
    }
}
